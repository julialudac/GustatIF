<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Accueil client</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="//code.jquery.com/jquery-1.12.1.min.js"></script>
    </head>
    <body>
        <div id="info" class="alert alert-danger" style="color:red;">
        </div>

        <script>
    
            // Toujours englober le code JQuery dans cette fonction !!!
            $(function() {
                
                // permettant de savoir si un email est au bon format. 
                // source : http://www.w3resource.com/javascript/form/email-validation.php
                function validateEmail(mail) {  
                    var reg = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
                    if (reg.test(mail))  
                     {  
                       return (true);  
                     }  
                       return (false);  
                }  

                // ------------------ permet de contrôler la direction : on reste sur la page ou pas---------------
                $('#info').hide();

                // en ce qui concerne f1
                $('#f1').submit(function (evt) {
                    var email = $('#mail').val();
                    if(email=="" || $('#mdp').val()==""){
                        $('#info').show();
                        $('#info').html("Veuillez compléter les champs de saisie de la connexion.");
                        evt.preventDefault();
                    }
                });
                
                // en ce qui concerne f2
                $('#f2').submit(function (evt) {
                    var email = $('#adrMail').val();
                    // vérif remplissage champs
                    if($('#prenom').val()=="" || $('#nom').val()=="" ||email=="" 
                            || $('#adrLivraison').val()=="" || $('#cp').val()=="" || $('#ville').val()==""){
                        $('#info').show();
                        $('#info').html("Veuillez compléter les champs de saisie de l'inscription.");
                        evt.preventDefault();
                    }
                    // vérif email & cp
                    else{
                        var mauvFormat = false;
                        var contentDanger = "";
                        // vérif email
                        if(!validateEmail(email)){
                            mauvFormat = true;
                            contentDanger ="Veuillez indiquez une adresse mail valide !";
                            $("#adrMail").css("color", "red");
                        }
                        else{
                            $("#adrMail").css("color", "black");
                        }
                        // vérif cp français
                        var cp = $('#cp').val();
                        var cpNb = parseInt(cp);
                        console.log(cp.length);
                        console.log(Number.isInteger(cpNb));
                        if(!Number.isInteger(cpNb) || cp.length!=5){
                            mauvFormat = true;
                            contentDanger +="   Veuillez indiquer un code postal fr valide !";
                            $('#cp').css("color", "red");
                        }
                        else{
                            $("#cp").css("color", "black");
                        }
                        
                        // si l'un des 2 est au mauvais format
                        if(mauvFormat){
                            $('#info').show();
                            $('#info').html(contentDanger);
                            evt.preventDefault();
                        }
                        
                    }
                    
                });

                // ------------------ permet de voir s'il y a une pop-up à afficher et laquelle ------------------
                var get = window.location.search.substring(1);

                if(get.length > 1)
                {
                    var nb = parseInt(get.substring(get.indexOf("=")+1));

                    //$('#info').show();

                    switch(nb)
                    {
                        case 1:
                            alert("Erreur : Aucun compte associé à cet email et ce mdp");
                            break;

                        case 2:
                            alert("Votre compte a bien été crée.");
                            break;

                        case 3:
                            alert("La création de votre compte a malheureusement échoué.");
                            break;

                        default:
                        //$('#info').hide();
                    }
                }

            });

        </script>
        <!--header-->
        <header>
            <div id="divLogo"> <img src=""/> </div>    
            <div>Gustat'IF : Livraison à domicile</div>
            <input type="submit" value="Non connecté" disabled="disabled" />
        </header>
        <!-- div principal -->
        <div>
            <!-- Authentification -->
            <h1 align="center">Bienvenue sur Gustat'IF ! Vous n'êtes pas connecté.</h1>
            <h2>Connexion</h2>
            <form action="./ActionServlet" method="POST" id="f1">
                <label for="email">E-mail utilisateur :</label> <input type="text" id="email" name="email" placeholder="<mail>"/> <br/>
                <label for="mdp">Mot de passe : </label> <input type="password" id="mdp" name="mdp" placeholder="<mdp>"/> </br>
                <input type="submit" value="Se connecter" name='action' />
            </form>
            <!-- Inscription -->
            <h2>Pas de compte ? Inscrivez-vous gratuitement ! </h2>
            <form action="./ActionServlet" method="POST" id="f2">
                <label for="prenom">Prénom : </label> <input type="text" id="prenom" name="prenom" placeholder="<pnom>"/> <br/>
                <label for="nom">Nom : </label> <input type="text" id="nom" name="nom" placeholder="<nom>"/> </br>
                <label for="adrMail">Adresse mail : </label> <input type="text" id="adrMail" name="adrMail" placeholder="<mail>"/> <br/>
                <label for="adrLivraison">Adresse de livraison : </label> <input type="text" id="adrLivraison" name="adrLivraison" placeholder="<adr>"/> </br>
                <label for="cp">Code postal : </label> <input type="text" id="cp" name="cp" placeholder="<cp>"/>
                <label for="ville">Ville : </label> <input type="text" id="ville" name="ville" placeholder="<ville>"/></br>
                <input type="reset" value="annuler"/><input type="submit" value="s'enregistrer" name='action'/>
            </form>
            <!-- footer -->
            <footer>
                <span><a href='conditions.html'>Conditions d'utilisation</a></span>
                <span><a href='politique.html'>Politique de confidentialité</a></span>
                <span><a href='mentions.html'>Mentions légales</a></span>
            </footer>        
        </div>        
    </body>
</html>
